# 동시성 제어 기법 성능 테스트 계획서 (v1.5)

## 1. 개요 (Overview)

**1.1. 문서 목적**
본 문서는 Java/Spring Boot 환경에서 다양한 동시성 제어(Concurrency Control) 기법을 적용했을 때의 성능 특성을 정량적으로 측정하고, 데이터 기반으로 각 기법의 장단점을 분석하기 위한 테스트 계획 및 요구사항을 정의하는 것을 목적으로 한다.

**1.2. 테스트 목표**
-   각 동시성 제어 기법의 성공, 실패 유형별 **정확한 분포(비율)** 측정
-   높은 경합(High Contention) 상황에서의 **대기 시간(Wait Time) 및 점유 시간(Dwell Time) 분포** 비교 분석
-   부하 누적에 따른 각 기법의 **성능 변화 추이** 및 **안정성** 파악 (`bin` 단위 분석)
-   **방(Room) 단위별 성능 특성 비교** 및 **전체 통합 성능** 동시 분석
-   애플리케이션의 특성에 맞는 최적의 동시성 제어 기법을 선택하기 위한 객관적인 데이터 확보

**1.3. 범위 (Scope)**
-   **테스트 대상 동시성 기법:** `if-else (No-Lock)`, `synchronized`, `ReentrantLock (non-fair/fair)`, `Semaphore`
-   **분석 수준:** 애플리케이션 레벨에서 수집된 로그를 기반으로, **`calculate_performance_stats.py`** 스크립트를 통해 생성된 정량적 지표 분석

---

## 2. 테스트 대상 시스템 (Target System)

-   **Application:** 채팅방 입장 처리(`RoomJoinService`) 기능을 포함한 Java / Spring Boot 웹 애플리케이션
-   **Core Logic:** 다수의 스레드가 동시에 특정 자원(채팅방 인원수)을 조회하고 갱신하는 로직

---

## 3. 테스트 방법론 (Test Methodology)

**3.1. 테스트 시나리오**
-   **시나리오:** 200명의 가상 사용자를 1초 이내에 동시에 요청(Burst-Fire)하여, 시스템이 순간적인 최대 부하를 어떻게 처리하는지 측정한다.
-   **측정:** 각 동시성 제어 기법을 적용하여 위 시나리오를 반복 실행하고, 결과를 개별적으로 기록한다.

**3.2. 핵심 성능 지표 (KPIs)**
"성능 분석 지표 계산 스크립트 요구사항"에 따라, 다음과 같이 상세 지표를 측정하고 분석한다.

-   **결과 분포 지표 (Outcome Distribution Metrics):**
    -   **요청 성공률 (%):** 전체 요청 중 최종 성공한 요청의 비율
    -   **진입 실패율 (%):** 락 획득 실패 등 임계 영역 진입 전 실패한 요청의 비율
    -   **정원 초과 실패율 (%):** 임계 영역 진입 후 비즈니스 로직(정원)에 의해 실패한 요청의 비율

-   **성공 성능 지표 (Success Performance Metrics):**
    -   **대기 시간 (Wait Time):** 락 획득을 위해 대기한 시간. 평균, 중앙값, 최댓값을 분석한다.
        - `(critical_enter_time - waiting_start_time)`
    -   **임계 영역 실행 시간 (Dwell Time):** 락을 점유하고 비즈니스 로직을 수행한 시간. 평균, 중앙값, 최댓값을 분석한다.
        - `(critical_leave_time - critical_enter_time)`

-   **실패 성능 지표 (Failure Performance Metrics):**
    -   **(정원 초과 시) 대기 시간:** 실패했지만 락 획득까지 대기한 시간. 평균, 중앙값, 최댓값을 분석한다.
    -   **(정원 초과 시) 실패 처리 시간:** 락 획득 후 실패로 처리되기까지 걸린 시간. 평균, 중앙값, 최댓값을 분석한다.
        - `(critical_leave_time - critical_enter_time)`

        ---

## 4. 테스트 프로세스 (Test Process)

1.  **구현:** 테스트할 동시성 제어 기법을 Java 코드에 적용한다.
2.  **빌드/배포:** 수정된 코드를 빌드하고 로컬 서버에 배포한다.
3.  **실행 및 로깅:** JMeter로 부하 테스트를 실행하고, 애플리케이션 로그를 수집한다.
4.  **1차 데이터 처리:** Python 스크립트로 로그를 파싱하여 분석 가능한 CSV 파일(`clean_*.csv`)로 가공한다.
5.  **통계 분석 및 리포팅 (수정됨):**
    `calculate_performance_stats.py` 스크립트를 사용하여 가공된 CSV 데이터를 최종 분석한다. 분석 결과는 **`{label}_stats.xlsx`** 파일로 생성되며, 다음과 같은 5개의 시트로 구성된다.
    -   **`Overall_Summary`:** 전체 요청의 성공/실패 분포를 파악하여 거시적인 성능을 요약한다.
    -   **`Overall_Success_Stats`:** 성공한 모든 요청의 대기 시간 및 실행 시간 통계(평균,중앙값,Max)를 통해 시스템의 일반적인 처리 성능을 확인한다.
    -   **`Overall_Capacity_Failed_Stats`:** 정원 초과로 실패한 요청들의 통계를 통해 실패 과정의 부하 특성을 분석한다.
    -   **`Per_Room_Stats`:** 각 방(Room)별로 모든 성능 지표를 집계하여, 특정 방에서 발생하는 성능 저하 문제를 식별한다.
    -   **`Per_Bin_Stats`:** 각 방을 시간 순서에 따른 구간(`bin`)으로 나누어 분석하여, 부하가 누적됨에 따른 성능 변화 추이를 파악한다.
6.  **결과 해석 및 결론 도출:** 생성된 5개의 분석 시트를 기반으로 각 동시성 제어 기법의 장단점을 정량적으로 비교 분석하여 최종 결론을 도출한다.
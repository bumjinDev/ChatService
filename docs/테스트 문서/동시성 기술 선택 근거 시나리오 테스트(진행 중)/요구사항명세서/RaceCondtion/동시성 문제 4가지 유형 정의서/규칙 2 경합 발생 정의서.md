# ê·œì¹™ 2: ê²½í•© ë°œìƒ (Contention Detected) ì •ì˜ì„œ

> [!IMPORTANT]
> **ë¬¸ì„œ ëª©ì **: ê²½ìŸ ìƒíƒœ ë¶„ì„ì—ì„œ 'ê²½í•© ë°œìƒ(Contention Detected)' í˜„ìƒì˜ ì™„ì „í•œ ì •ì˜, ë°œìƒ ì›ì¸, íƒì§€ ë°©ë²•ì„ ëª…í™•íˆ ì •ì˜í•©ë‹ˆë‹¤.

---

## 1. ê°œë… ì •ì˜

### 1.0 ìš©ì–´ ì •ì˜
- **ì„ê³„êµ¬ì—­ (Critical Section)**: `prev_entry_time ~ curr_entry_time` êµ¬ê°„
- **Contention Detected**: ê²½í•© ë°œìƒ íƒì§€ í˜„ìƒì˜ ì˜ë¬¸ í‘œí˜„
- **ê²½í•© ê·¸ë£¹ (Contention Group)**: ì‹œê°„ì ìœ¼ë¡œ ê²¹ì¹˜ëŠ” ëª¨ë“  ìŠ¤ë ˆë“œì˜ ì§‘í•©
- **ë‚˜ë…¸ì´ˆ ì •ë°€ë„**: 10^-9ì´ˆ ë‹¨ìœ„ì˜ ê³ ì •ë°€ ì‹œê°„ ì¸¡ì •

### 1.1 Contention Detectedë€?

> [!WARNING]
> **Contention Detected**: ë‘ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œê°€ ìì‹ ë“¤ì˜ ì„ê³„êµ¬ì—­ì„ 1 ë‚˜ë…¸ì´ˆë¼ë„ ì„œë¡œ ê³µìœ í•˜ëŠ” ê²½ìš°, í•´ë‹¹ ê·¸ë£¹ì— ì†í•œ ëª¨ë“  ìŠ¤ë ˆë“œì—ì„œ íƒì§€ë˜ëŠ” í˜„ìƒ. ìµœì¢… ê²°ê³¼ ê°’ì— ì˜¤ë¥˜ê°€ ì—†ë”ë¼ë„, ë™ì‹œì„± ì œì–´ì˜ ë¶€ì¬ë¡œ ì¸í•´ ì ì¬ì  ìœ„í—˜ì— ë…¸ì¶œëœ ìƒí™©

### 1.2 í•µì‹¬ íŠ¹ì§• ë° íŒë³„ ê¸°ì¤€
- **ì‹œê°„ êµ¬ê°„ ê²¹ì¹¨ íƒì§€**: `prev_entry_time ~ curr_entry_time` êµ¬ê°„ì´ 1ë‚˜ë…¸ì´ˆë¼ë„ ê²¹ì¹˜ëŠ” ëª¨ë“  ìŠ¤ë ˆë“œ
- **ì •í™•í•œ ìˆ˜í•™ì  ì¡°ê±´ì‹**: 
  ```
  Thread A: [start1, end1], Thread B: [start2, end2]
  ê²½í•© ë°œìƒ ì¡°ê±´: NOT (end1 < start2 OR end2 < start1)
  ì¦‰, !(Aì¢…ë£Œ < Bì‹œì‘ || Bì¢…ë£Œ < Aì‹œì‘) = ê²¹ì¹¨ ë°œìƒ
  ```
- **ì ì¬ì  ìœ„í—˜ ì‹ë³„**: ì‹¤ì œ ë°ì´í„° ì˜¤ë¥˜ ë°œìƒ ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ ë™ì‹œì„± ì œì–´ ë¶€ì¬ ìƒí™© íƒì§€
- **ê·¸ë£¹ ë‹¨ìœ„ ë¶„ì„**: ê²½í•©ì— ì°¸ì—¬í•œ ëª¨ë“  ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ ë¶„ì„
- **ì˜ˆë°©ì  ê´€ì **: ë¬¸ì œê°€ ë°œìƒí•˜ê¸° ì „ì— ìœ„í—˜í•œ ìƒí™©ì„ ì‚¬ì „ ì‹ë³„

### 1.3 ë°ì´í„° êµ¬ì¡° ì •ì˜

#### 1.3.1 ê²½í•© ê´€ë ¨ í•µì‹¬ í•„ë“œ
| í•„ë“œëª… | ë°ì´í„° íƒ€ì… | ì •ì˜ | ì˜ˆì‹œ |
|--------|-------------|------|------|
| `contention_group_size` | Float | ë™ì‹œ ê²½í•©í•œ ìŠ¤ë ˆë“œì˜ ì´ ê°œìˆ˜ (ì •ìˆ˜ê°’ì´ì§€ë§Œ Float íƒ€ì…ìœ¼ë¡œ ì €ì¥) | 3.0 (3ê°œ ìŠ¤ë ˆë“œ ê²½í•©) |
| `contention_user_ids` | String | ê²½í•© ì°¸ì—¬ ì‚¬ìš©ì ID (ì‰¼í‘œ êµ¬ë¶„) | "user_1001,user_1002,user_1003" |
| `true_critical_section_start` | DateTime | ì„ê³„êµ¬ì—­ ì§„ì… ì‹œê° | 2024-01-01 10:00:01.100 |
| `true_critical_section_end` | DateTime | ì„ê³„êµ¬ì—­ ì¢…ë£Œ ì‹œê° | 2024-01-01 10:00:01.300 |
| `true_critical_section_duration` | Float | ì„ê³„êµ¬ì—­ ì§€ì†ì‹œê°„(ì´ˆ) | 0.2 |

#### 1.3.2 ë‚˜ë…¸ì´ˆ ì •ë°€ë„ ì¸¡ì • í•„ë“œ
| í•„ë“œëª… | ë°ì´í„° íƒ€ì… | ì •ì˜ |
|--------|-------------|------|
| `true_critical_section_nanoTime_start` | Float | ë‚˜ë…¸ì´ˆ ì •ë°€ë„ ì‹œì‘ ì‹œê° |
| `true_critical_section_nanoTime_end` | Float | ë‚˜ë…¸ì´ˆ ì •ë°€ë„ ì¢…ë£Œ ì‹œê° |
| `true_critical_section_epochNano_start` | Float | Epoch ê¸°ì¤€ ë‚˜ë…¸ì´ˆ ì‹œì‘ ì‹œê° |
| `true_critical_section_epochNano_end` | Float | Epoch ê¸°ì¤€ ë‚˜ë…¸ì´ˆ ì¢…ë£Œ ì‹œê° |

### 1.4 ê²½í•© ê·¸ë£¹ í˜•ì„± ê·œì¹™
- **ê·¸ë£¹ í˜•ì„± ì•Œê³ ë¦¬ì¦˜**: ì‹œê°„ êµ¬ê°„ì´ ê²¹ì¹˜ëŠ” ëª¨ë“  ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ì˜ ê²½í•© ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜
- **êµ¬ì²´ì  êµ¬í˜„ ë¡œì§**: 
  ```python
  # racecondition_anomaly_detector.pyì˜ find_contention_groups() í•¨ìˆ˜
  # 1.2ì˜ "NOT (end1 < start2 OR end2 < start1)" ì¡°ê±´ì‹ì„ ì½”ë“œë¡œ êµ¬í˜„
  if not (end1 < start2 or end2 < start1):
      # ë‘ ìŠ¤ë ˆë“œê°€ ê²½í•© ìƒíƒœ
      overlapping_users.append(user2)
  ```
- **ê·¸ë£¹ í¬ê¸°**: ë™ì‹œì— ê²¹ì¹˜ëŠ” ìŠ¤ë ˆë“œì˜ ì´ ê°œìˆ˜ (`contention_group_size`)
- **ê·¸ë£¹ ì‹ë³„**: ê° ìŠ¤ë ˆë“œëŠ” ìì‹ ì´ ì†í•œ ê²½í•© ê·¸ë£¹ì˜ í¬ê¸°ì™€ ì°¸ì—¬ì ëª©ë¡ ì •ë³´ ë³´ìœ 

### 1.5 ë‹¤ë¥¸ ê·œì¹™ê³¼ì˜ êµ¬ë¶„ ê¸°ì¤€

#### 1.5.1 ê²½í•© ë°œìƒ vs ê°’ ë¶ˆì¼ì¹˜
- **ê²½í•© ë°œìƒ**: ì‹œê°„ êµ¬ê°„ë§Œ ê²¹ì¹˜ë©´ íƒì§€ (ê²°ê³¼ê°’ ë¬´ê´€)
- **ê°’ ë¶ˆì¼ì¹˜**: ê²½í•© + ì‹¤ì œ `curr_people â‰  expected_people` ë°œìƒ

#### 1.5.2 ê²½í•© ë°œìƒ vs ì •ì› ì´ˆê³¼
- **ê²½í•© ë°œìƒ**: ë™ì‹œ ì ‘ê·¼ ìì²´ë¥¼ íƒì§€ (ì •ì› ë¬´ê´€)
- **ì •ì› ì´ˆê³¼**: ê²½í•© ê²°ê³¼ë¡œ `curr_people > max_people` ìœ„ë°˜

#### 1.5.3 ê²½í•© ë°œìƒ vs ìƒíƒœ ì „ì´ ì˜¤ë¥˜
- **ê²½í•© ë°œìƒ**: ì‹œê°„ì  ê²¹ì¹¨ íƒì§€
- **ìƒíƒœ ì „ì´ ì˜¤ë¥˜**: ê²½í•© ê²°ê³¼ë¡œ `curr_people â‰  1+room_entry_sequence` ë°œìƒ

#### 1.5.4 ë…ë¦½ì  íŒì •
- í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œì—ì„œ ì—¬ëŸ¬ ê·œì¹™ì´ ë™ì‹œì— ìœ„ë°˜ë  ìˆ˜ ìˆìŒ
- ê° ê·œì¹™ì€ ë…ë¦½ì ìœ¼ë¡œ íŒì •ë˜ì–´ `anomaly_type`ì— ì‰¼í‘œë¡œ êµ¬ë¶„ë˜ì–´ ê¸°ë¡
- **ì‹¤ì œ ì˜ˆì‹œ**: `"ê²½í•© ë°œìƒ ìì²´, ê°’ ë¶ˆì¼ì¹˜"` ë˜ëŠ” `"ê²½í•© ë°œìƒ ìì²´, ì •ì› ì´ˆê³¼ ì˜¤ë¥˜"`

### 1.6 ì¸¡ì • ë‹¨ìœ„ì™€ ì •ë°€ë„
- **ì¼ë°˜ timestamp**: ë°€ë¦¬ì´ˆ ë‹¨ìœ„ ì •ë°€ë„ (`prev_entry_time`, `curr_entry_time`)
- **ë‚˜ë…¸ì´ˆ timestamp**: ë‚˜ë…¸ì´ˆ ë‹¨ìœ„ ì •ë°€ë„ (10^-9ì´ˆ)
- **ì •ë°€ë„ í–¥ìƒ ì˜ë¯¸**: ë§¤ìš° ì§§ì€ ì‹œê°„ ê°„ê²©ì˜ ê²½í•©ë„ ì •í™•íˆ íƒì§€ ê°€ëŠ¥
- **í™œìš©**: ë‚˜ë…¸ì´ˆ ë°ì´í„°ë¡œ ë” ì •ë°€í•œ ê²½í•© ì§€ì†ì‹œê°„ ì¸¡ì •

---

## 2. ë°œìƒ ì›ì¸ ë° ë©”ì»¤ë‹ˆì¦˜

### 2.1 ê·¼ë³¸ ì›ì¸

#### 2.1.1 ì„ê³„ êµ¬ì—­ ë³´í˜¸ ë¶€ì¬
- **ë™ì‹œ ì§„ì… í—ˆìš©**: ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ê°™ì€ ì„ê³„ êµ¬ì—­ì— ì§„ì… ê°€ëŠ¥
- **ì›ìì„± ë¶€ì¡±**: ì½ê¸°-ê²€ì¦-ìˆ˜ì •-ì“°ê¸° ì „ì²´ ê³¼ì •ì´ í•˜ë‚˜ì˜ ì›ìì  ì—°ì‚°ìœ¼ë¡œ ë³´í˜¸ë˜ì§€ ì•ŠìŒ
- **ê²½ìŸ ì¡°ê±´ ìƒì„±**: ìŠ¤ë ˆë“œ ê°„ ì‹¤í–‰ ìˆœì„œì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ëŠ” ìƒí™© ë°œìƒ

#### 2.1.2 ì‹œê°„ì  ì¤‘ë³µ íŒ¨í„´
```
ê²½í•© ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤:
Thread A: [-------- ì„ê³„ êµ¬ì—­ --------]
Thread B:      [-------- ì„ê³„ êµ¬ì—­ --------]
Thread C:           [--- ì„ê³„ êµ¬ì—­ ---]
ê²¹ì¹¨ êµ¬ê°„:      [XXXXXXX ê²½í•© ë°œìƒ XXXXXXX]
```

### 2.2 ë°œìƒ ë©”ì»¤ë‹ˆì¦˜

#### 2.2.1 ì „í˜•ì ì¸ Contention ì‹œë‚˜ë¦¬ì˜¤
1. **ì´ˆê¸° ìƒíƒœ**: ë°©ì— 5ëª… ì¡´ì¬
2. **Thread A**: 10:00:01.100ì— ì„ê³„ êµ¬ì—­ ì§„ì… (PRE_JOIN_CURRENT_STATE)
3. **Thread B**: 10:00:01.150ì— ì„ê³„ êµ¬ì—­ ì§„ì… (ë™ì‹œ ì§„ì…!)
4. **Thread C**: 10:00:01.200ì— ì„ê³„ êµ¬ì—­ ì§„ì… (3ì¤‘ ê²½í•©!)
5. **Thread A**: 10:00:01.300ì— ì„ê³„ êµ¬ì—­ ì¢…ë£Œ (JOIN_SUCCESS_EXISTING)
6. **ê²°ê³¼**: 3ê°œ ìŠ¤ë ˆë“œ ëª¨ë‘ ê²½í•© ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜

#### 2.2.2 ë‚˜ë…¸ì´ˆ ì •ë°€ë„ íƒì§€ì˜ ì¤‘ìš”ì„±
- **ë¯¸ì„¸í•œ ê²¹ì¹¨ íƒì§€**: ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œëŠ” ë†“ì¹  ìˆ˜ ìˆëŠ” ì§§ì€ ê²½í•©ë„ í¬ì°©
- **ì‹¤ì œ ë™ì‹œì„± ìˆ˜ì¤€ ì¸¡ì •**: ì‹œìŠ¤í…œì˜ ì‹¤ì œ ë™ì‹œ ì ‘ì† ì²˜ë¦¬ ëŠ¥ë ¥ í‰ê°€
- **ì„±ëŠ¥ ë³‘ëª© ì‹ë³„**: ì„ê³„ êµ¬ì—­ì—ì„œì˜ ëŒ€ê¸° ì‹œê°„ê³¼ ì²˜ë¦¬ëŸ‰ ë¶„ì„

---

## 3. ì‹¤ì œ ì‚¬ë¡€ ë° ì‹œë‚˜ë¦¬ì˜¤

### 3.1 RoomJoinServiceIfElseì—ì„œì˜ ë°œìƒ ìƒí™©

#### 3.1.1 ì„ê³„êµ¬ì—­ ì •ì˜ì™€ ê²½í•© íƒì§€

**ì„±ê³µ ì¼€ì´ìŠ¤ ê²½í•©:**
```java
// Thread A: ì„ê³„êµ¬ì—­ ì‹œì‘
PRE_JOIN_CURRENT_STATE: 2024-01-15 14:23:45.127 currentPeople=5 maxPeople=20

// Thread B: ì„ê³„êµ¬ì—­ ì‹œì‘ (ê²½í•© ì‹œì‘!)  
PRE_JOIN_CURRENT_STATE: 2024-01-15 14:23:45.129 currentPeople=5 maxPeople=20

// Thread A: ì„ê³„êµ¬ì—­ ì¢…ë£Œ (ì„±ê³µ)
JOIN_SUCCESS_EXISTING: 2024-01-15 14:23:45.145 currentPeople=6 maxPeople=20

// Thread B: ì„ê³„êµ¬ì—­ ì¢…ë£Œ (ì„±ê³µ, ê²½í•© ê·¸ë£¹ í˜•ì„±)
JOIN_SUCCESS_EXISTING: 2024-01-15 14:23:45.152 currentPeople=6 maxPeople=20
```

**ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ê²½í•©:**
```java
// Thread A: ì„ê³„êµ¬ì—­ ì‹œì‘ (ì •ì› ì„ë°• ìƒí™©)
PRE_JOIN_CURRENT_STATE: 2024-01-15 14:23:46.234 currentPeople=19 maxPeople=20

// Thread B: ì„ê³„êµ¬ì—­ ì‹œì‘ (ê²½í•© ì‹œì‘!)
PRE_JOIN_CURRENT_STATE: 2024-01-15 14:23:46.236 currentPeople=19 maxPeople=20

// Thread A: ì„ê³„êµ¬ì—­ ì¢…ë£Œ (ì„±ê³µ)
JOIN_SUCCESS_EXISTING: 2024-01-15 14:23:46.251 currentPeople=20 maxPeople=20

// Thread B: ì„ê³„êµ¬ì—­ ì¢…ë£Œ (ì‹¤íŒ¨)
JOIN_FAIL_OVER_CAPACITY_EXISTING: 2024-01-15 14:23:46.258 currentPeople=20 maxPeople=20
```

#### 3.1.2 ê²½í•© ê·¸ë£¹ í˜•ì„± ê³¼ì •
- **ë™ì‹œ ì§„ì… í™•ì¸**: ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê°™ì€ ì‹œì ì— ì„ê³„êµ¬ì—­ ì§„ì…
- **ì‹œê°„ êµ¬ê°„ ì¤‘ë³µ**: ê° ìŠ¤ë ˆë“œì˜ `prev_entry_time ~ curr_entry_time` êµ¬ê°„ì´ ê²¹ì¹¨
- **ê·¸ë£¹ ìë™ ìƒì„±**: Python íŒŒì„œê°€ ê²¹ì¹˜ëŠ” ëª¨ë“  ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ì˜ ê²½í•© ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¥˜

### 3.2 ì‹¤ì œ ë¡œê·¸ ë°ì´í„° íŒ¨í„´

#### 3.2.1 ì „í˜•ì ì¸ ê²½í•© ë¡œê·¸ ì‹œí€€ìŠ¤
```
2024-01-15 14:23:45.127 - Thread-A: PRE_JOIN_CURRENT_STATE currentPeople=5
2024-01-15 14:23:45.129 - Thread-B: PRE_JOIN_CURRENT_STATE currentPeople=5  â† ê²½í•© ì‹œì‘
2024-01-15 14:23:45.131 - Thread-C: PRE_JOIN_CURRENT_STATE currentPeople=5  â† 3ì¤‘ ê²½í•©
2024-01-15 14:23:45.145 - Thread-A: JOIN_SUCCESS_EXISTING currentPeople=6
2024-01-15 14:23:45.152 - Thread-B: JOIN_SUCCESS_EXISTING currentPeople=6   â† Lost Update ë°œìƒ
2024-01-15 14:23:45.159 - Thread-C: JOIN_SUCCESS_EXISTING currentPeople=6   â† Lost Update ë°œìƒ
```

#### 3.2.2 Python íŒŒì„œê°€ íƒì§€í•˜ëŠ” íŒ¨í„´
- **ì‹œê°„ êµ¬ê°„ ê²¹ì¹¨**: `prev_entry_time ~ curr_entry_time` êµ¬ê°„ ì¤‘ë³µ í™•ì¸
- **ê²½í•© ê·¸ë£¹ ìƒì„±**: ê²¹ì¹˜ëŠ” ëª¨ë“  ìŠ¤ë ˆë“œë¥¼ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ìŒ
- **ê·¸ë£¹ í¬ê¸° ê³„ì‚°**: ê° ìŠ¤ë ˆë“œì— ê²½í•© ê·¸ë£¹ í¬ê¸° ì •ë³´ ë¶€ì—¬

### 3.3 ë°©ë³„ ë°œìƒ íŒ¨í„´

#### 3.3.1 ë°©ë³„ ê²½í•© ë°œìƒ íŒ¨í„´
- **ë™ì‹œ ì ‘ì† ì§‘ì¤‘**: íŠ¹ì • ë°©ì—ì„œ ë™ì‹œ ì ‘ì† ì‹œë„ê°€ ëª°ë¦¬ëŠ” ê²½ìš° ê²½í•© ë¹ˆë°œ
- **í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ íŠ¹ì„±**: ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì¤‘ ì¸ìœ„ì ìœ¼ë¡œ ìƒì„±ëœ ë™ì‹œ ì ‘ì† íŒ¨í„´

#### 3.3.2 ì‹œê°„ëŒ€ë³„ íŠ¹ì„±
```
ë†’ì€ ê²½í•© ë°œìƒ êµ¬ê°„:
- Bin 1-3: í…ŒìŠ¤íŠ¸ ì´ˆê¸° ëŒ€ëŸ‰ ë™ì‹œ ìš”ì²­ìœ¼ë¡œ ì¸í•œ ê²½í•© í­ì¦
- Bin 8-10: í…ŒìŠ¤íŠ¸ ì¢…ë£Œ ì „ ë§ˆì§€ë§‰ ì…ì¥ ì‹œë„ë¡œ ì¸í•œ ê²½í•© ì§‘ì¤‘
- íŠ¹ì • ë‚˜ë…¸ì´ˆ êµ¬ê°„: ì •í™•íˆ ê°™ì€ ì‹œì ì— ì—¬ëŸ¬ ìŠ¤ë ˆë“œ ì§„ì…í•˜ëŠ” ê·¹í•œ ìƒí™©
```

---

## 4. ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥ ë¶„ì„

### 4.1 ì§ì ‘ì  ì˜í–¥

#### 4.1.1 ì‹œìŠ¤í…œ ì•ˆì •ì„± ìœ„í—˜ ì‹ í˜¸
- **ë™ì‹œì„± ì œì–´ ë¶€ì¬ ì¦ëª…**: í˜„ì¬ ì‹œìŠ¤í…œì´ ë™ì‹œ ì ‘ì†ì„ ì ì ˆíˆ ì œì–´í•˜ì§€ ëª»í•¨ì„ ì…ì¦
- **í™•ì¥ì„± í•œê³„ ë…¸ì¶œ**: ì‚¬ìš©ì ì¦ê°€ ì‹œ ê²½í•© ë¹ˆë„ì™€ ê°•ë„ê°€ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦ê°€í•  ê°€ëŠ¥ì„±
- **ë°ì´í„° ì •í•©ì„± ìœ„í—˜**: ê²½í•©ì´ ë°œìƒí•œ ëª¨ë“  ìƒí™©ì—ì„œ Lost Updateë‚˜ ì •ì› ì´ˆê³¼ ê°€ëŠ¥ì„± ì¡´ì¬

### 4.2 ì‹œìŠ¤í…œ í™•ì¥ì„± ì˜í–¥

#### 4.2.1 ë™ì‹œì„± ì œì–´ êµ¬ì¡°ì˜ ê·¼ë³¸ì  í•œê³„
```java
// ğŸš¨ ê²½í•© ë°œìƒ ì§€ì : ë³´í˜¸ë˜ì§€ ì•ŠëŠ” ì„ê³„ êµ¬ì—­
if (chatRoom.get().getCurrentPeople() >= chatRoom.get().getMaxPeople()) {
    // ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì´ ì¡°ê±´ì„ í™•ì¸ ê°€ëŠ¥
    // â†’ ëª¨ë“  ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì§„í–‰í•˜ì—¬ ê²½í•© ë°œìƒ
    throw new RoomBadJoinFullException("ì…ì¥ ì‹¤íŒ¨: ë°© ì •ì›ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.");
} else {
    // ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ì¦ê°€ ì—°ì‚° ìˆ˜í–‰
    chatSessionRegistry.incrementCurrentPeople(roomNumber);
}
```

#### 4.2.2 ê²½í•© ê°•ë„ ì¸¡ì •ì˜ ì˜ë¯¸
```java
// ğŸ”§ ë‚˜ë…¸ì´ˆ ì •ë°€ë„ë¡œ ì •í™•í•œ ê²½í•© ê°•ë„ ì¸¡ì •
contention_group_size: 3  // 3ê°œ ìŠ¤ë ˆë“œê°€ ë™ì‹œ ê²½í•©
contention_user_ids: "user123,user456,user789"

// ğŸ“Š ê²°ê³¼: ì‹œìŠ¤í…œì´ ì‹¤ì œë¡œ ì–´ëŠ ì •ë„ì˜ ë™ì‹œì„±ì„ ì²˜ë¦¬í•˜ê³  ìˆëŠ”ì§€ ì •ëŸ‰ ì¸¡ì •
//         ê²½í•© ê·¸ë£¹ í¬ê¸°ê°€ í´ìˆ˜ë¡ ë™ì‹œì„± ì œì–´ ì‹¤íŒ¨ ì‹¬ê°ë„ ë†’ìŒ
```

---

## 5. ë¶„ì„ ë°©ë²•ë¡ 

### 5.1 ê°œë³„ ì¼€ì´ìŠ¤ ë¶„ì„

#### 5.1.1 ë¶„ì„ ìš”ì†Œ
- **ê²½í•© ì‹œì‘ ì‹œì **: `prev_entry_time` (ì„ê³„êµ¬ì—­ ì§„ì… ì‹œê°)
- **ê²½í•© ì¢…ë£Œ ì‹œì **: `curr_entry_time` (ì„ê³„êµ¬ì—­ ì¢…ë£Œ ì‹œê°)
- **ê²½í•© ê·¸ë£¹ í¬ê¸°**: `contention_group_size` (ë™ì‹œ ê²½í•© ìŠ¤ë ˆë“œ ìˆ˜)
- **ì°¸ì—¬ ìŠ¤ë ˆë“œ ëª©ë¡**: `contention_user_ids` (ê²½í•©ì— ì°¸ì—¬í•œ ëª¨ë“  ì‚¬ìš©ì)

#### 5.1.2 ë¶„ì„ ì§€í‘œ
- **ê²½í•© ì§€ì† ì‹œê°„**: ì„ê³„êµ¬ì—­ ê²¹ì¹¨ì´ ì§€ì†ëœ ì‹œê°„ (ë‚˜ë…¸ì´ˆ ì •ë°€ë„)
- **ê²½í•© ê°•ë„**: ë™ì‹œì— ê²½í•©í•œ ìŠ¤ë ˆë“œ ìˆ˜ì˜ ìµœëŒ€ê°’
- **ê²½í•© ë¹ˆë„**: íŠ¹ì • ì‹œê°„ êµ¬ê°„ ë‚´ ê²½í•© ë°œìƒ íšŸìˆ˜

### 5.2 í†µê³„ì  ë¶„ì„

#### 5.2.1 ë°©ë³„/êµ¬ê°„ë³„ ì§‘ê³„
```python
# generate_race_condition_report.pyì—ì„œ ì‹¤ì œ ìˆ˜í–‰í•˜ëŠ” ì§‘ê³„
# ê²½í•© ë°œìƒ íŒ¨í„´ì„ 'ê²½í•© ë°œìƒ'ìœ¼ë¡œ ê²€ìƒ‰ (ì‹¤ì œë¡œëŠ” 'ê²½í•© ë°œìƒ ìì²´'ë¥¼ í¬í•¨í•˜ì—¬ íƒì§€)
self.rule_stats['contention'] = len(self.df_result[
    self.df_result['anomaly_type'].str.contains('ê²½í•© ë°œìƒ', na=False)
])

# ê²½í•© ê·¸ë£¹ í¬ê¸°ë³„ ë¶„í¬ ë¶„ì„ - 2ê°œ, 3ê°œ, 4ê°œ+ ìŠ¤ë ˆë“œ ê²½í•©ì˜ ë¹ˆë„ ê³„ì‚°
contention_groups = self.df_result.groupby('contention_group_size').size()
```

#### 5.2.2 ì§‘ê³„ ë¶„ì„
- **ë°©ë³„ ê²½í•© ë¶„í¬**: ê° ë°©ì—ì„œ ë°œìƒí•œ ê²½í•© ë¹ˆë„ì™€ ê°•ë„ ë¶„ì„
- **ì‹œê°„ëŒ€ë³„ íŒ¨í„´**: `bin` ë‹¨ìœ„ êµ¬ê°„ë³„ ê²½í•© ë°œìƒ íŒ¨í„´ ë¶„ì„
- **ê²½í•© ê·¸ë£¹ í¬ê¸° ë¶„í¬**: 2ê°œ, 3ê°œ, 4ê°œ+ ìŠ¤ë ˆë“œ ê²½í•©ì˜ ë¹„ìœ¨ ë¶„ì„

---

## 6. ì˜ˆë°© ë° í•´ê²°ì±…

### 6.1 ë™ì‹œì„± ì œì–´ ë©”ì»¤ë‹ˆì¦˜

#### 6.1.1 ReentrantLockì„ ì´ìš©í•œ ì„ê³„êµ¬ì—­ ë³´í˜¸
```java
// ê²½í•© ë°©ì§€ë¥¼ ìœ„í•œ ëª…ì‹œì  ì ê¸ˆ
private final ReentrantLock roomLock = new ReentrantLock();

public boolean tryJoinRoomWithLock(int roomNumber) {
    roomLock.lock();
    try {
        // ì „ì²´ ì„ê³„êµ¬ì—­ì„ í•˜ë‚˜ì˜ ì ê¸ˆìœ¼ë¡œ ë³´í˜¸
        ChatRoom room = getRoom(roomNumber);
        if (room != null && room.getCurrentPeople() < room.getMaxPeople()) {
            room.setCurrentPeople(room.getCurrentPeople() + 1);
            return true;  // ì…ì¥ ì„±ê³µ
        }
        return false;  // ì…ì¥ ì‹¤íŒ¨
    } finally {
        roomLock.unlock();  // ë°˜ë“œì‹œ ì ê¸ˆ í•´ì œ
    }
}
```

#### 6.1.2 synchronizedë¥¼ ì´ìš©í•œ ë©”ì„œë“œ ë ˆë²¨ ë³´í˜¸
```java
// ë©”ì„œë“œ ì „ì²´ë¥¼ ì„ê³„êµ¬ì—­ìœ¼ë¡œ ë³´í˜¸
public synchronized boolean confirmJoinRoomSynchronized(int roomNumber, String userId) {
    ChatRoom chatRoom = chatSessionRegistry.getRoom(roomNumber);
    if (chatRoom == null) return false;
    
    // ì¡°ê±´ ê²€ì‚¬ì™€ ìƒíƒœ ë³€ê²½ì„ í•˜ë‚˜ì˜ ë™ê¸°í™” ë¸”ë¡ì—ì„œ ì²˜ë¦¬
    if (chatRoom.getCurrentPeople() >= chatRoom.getMaxPeople()) {
        return false;  // ì…ì¥ ì‹¤íŒ¨
    } else {
        chatSessionRegistry.incrementCurrentPeople(roomNumber);
        return true;   // ì…ì¥ ì„±ê³µ
    }
}
```

#### 6.1.3 Semaphoreë¥¼ ì´ìš©í•œ ë™ì‹œ ì ‘ê·¼ ì œí•œ
```java
// ì‹¤ì œ êµ¬í˜„ëœ ì„¸ë§ˆí¬ì–´ ê¸°ë°˜ ë™ì‹œì„± ì œì–´ (RoomJoinService.java)
@Service
public class RoomJoinService implements IRoomJoinService {
    
    private final SemaphoreRegistry semaphoreRegistry;
    private final ChatSessionRegistry chatSessionRegistry;
    
    /**
     * ì…ì¥ ì‚¬ì „ ê²€ì¦ ë° permit ì ìœ 
     */
    @Override
    @Transactional
    public void confirmJoinRoom(int roomNumber, String userId) {
        
        // ì¤‘ë³µ ì„¸ì…˜ í™•ì¸
        if(chatSessionRegistry.containsUser(String.valueOf(roomNumber), userId)){
            return;
        }
        
        // ê¸°ì¡´ ë°©ì¸ ê²½ìš°
        Optional<ChatRoom> chatRoom = Optional.ofNullable(chatSessionRegistry.getRoom(roomNumber));
        if (chatRoom.isPresent()) {
            // permit ì ìœ  ì‹œë„ - ë°©ë³„ ë™ì‹œ ì ‘ê·¼ ì œí•œ
            boolean acquired = semaphoreRegistry.tryAcquire(roomNumber, userId);
            
            if (!acquired) {
                logger.warn("[ì…ì¥ ê±°ë¶€] ê¸°ì¡´ ë°© permit ì ìœ  ì‹¤íŒ¨: roomNumber={}, userId={}", roomNumber, userId);
                throw new RoomBadJoinFullException("ì…ì¥ ì‹¤íŒ¨: ë°© ì •ì›ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.");
            }
            
            logger.warn("[ë°© ì—¬ìœ  ì¸ì›ìˆ˜] : roomNumber={}, ë°© ì—¬ìœ  ì¸ì›ìˆ˜={}", 
                roomNumber, semaphoreRegistry.getAvailablePermits(roomNumber));
            return;
        }
    }
    
    /**
     * ì‹¤ì œ ì…ì¥ í™•ì •, permit ê¸°ë°˜ ì¸ì›ìˆ˜ ë™ê¸°í™”
     */
    @Override
    @Transactional
    public void joinRoom(int roomNumber) {
        // ì„¸ë§ˆí¬ì–´ ê¸°ë°˜ permitìœ¼ë¡œ ì¸ì›ìˆ˜ ë™ê¸°í™”
        chatSessionRegistry.updateRoomCurrentPeople(roomNumber, 
            chatSessionRegistry.getRoom(roomNumber).getMaxPeople() - 
            semaphoreRegistry.getAvailablePermits(roomNumber));
            
        logger.info("[updateRoomCurrentPeople] ë™ê¸°í™”: roomNumber={}, availablePermits={}", 
            roomNumber, semaphoreRegistry.getAvailablePermits(roomNumber));
    }
}
```

---

## 7. ê´€ë ¨ ë¬¸ì„œ ë° ì°¸ì¡°

### 7.1 ì—°ê´€ ê·œì¹™
- **ê·œì¹™ 1 (ê°’ ë¶ˆì¼ì¹˜)**: ê²½í•© ë°œìƒì´ ì§ì ‘ì ìœ¼ë¡œ ìœ ë°œí•˜ëŠ” Lost Update í˜„ìƒ
- **ê·œì¹™ 3 (ì •ì› ì´ˆê³¼)**: ê²½í•©ìœ¼ë¡œ ì¸í•œ ë™ì‹œ ì…ì¥ì´ ì´ˆë˜í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìœ„ë°˜
- **ê·œì¹™ 4 (ìƒíƒœ ì „ì´)**: ê²½í•© ìƒí™©ì—ì„œ ë°œìƒí•˜ëŠ” ë˜ ë‹¤ë¥¸ í˜•íƒœì˜ ë°ì´í„° ë¶ˆì¼ì¹˜

### 7.2 êµ¬í˜„ ì°¸ì¡°
- **`racecondition_anomaly_detector.py`**: ê²½í•© ê·¸ë£¹ íƒì§€ ë¡œì§ êµ¬í˜„ (find_contention_groups í•¨ìˆ˜)
- **`generate_race_condition_report.py`**: ê°„íŠ¸ ì°¨íŠ¸ ìƒì„± ë° ê²½í•© ë¶„ì„ (create_rule2_contention_gantt_chart ë©”ì„œë“œ)
- **`racecondition_event_preprocessor.py`**: ë¡œê·¸ ì „ì²˜ë¦¬ ë° ì„ê³„êµ¬ì—­ ì‹œì  ì¶”ì¶œ
- **`anomaly_result.csv`**: ê²½í•© ë¶„ì„ ê²°ê³¼ ë°ì´í„° (contention_group_size, contention_user_ids ì»¬ëŸ¼)

---

> [!NOTE]
> **ë¬¸ì„œ ìƒíƒœ**: ìµœì¢… ë²„ì „  
> **ë‹´ë‹¹ì**: ì •ë²”ì§„
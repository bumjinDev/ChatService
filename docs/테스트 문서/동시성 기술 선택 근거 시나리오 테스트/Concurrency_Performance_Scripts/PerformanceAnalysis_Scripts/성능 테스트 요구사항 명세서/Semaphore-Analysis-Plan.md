# [분석 계획서] Semaphore 동시성 제어 구조 분석

## 1. 분석 목표 및 패러다임 전환

`synchronized`와 `ReentrantLock`이 '상호 배제(Mutual Exclusion)'를 통해 한 번에 하나의 스레드만 허용하는 방식이라면, `Semaphore`는 **'허가(Permit)' 기반으로 정해진 수(N)의 스레드만 동시 접근을 허용**하는 다른 패러다임의 동시성 제어 기법이다.

따라서, 본 분석은 이전의 잠금 방식과 동일한 기준으로 성능을 비교하는 것이 아니라, `Semaphore`의 고유한 특성인 **'시스템 과부하 방지'**와 **'처리량 제어(Throttling)'** 능력에 초점을 맞춘다.

## 2. 기존 분석 프레임워크의 재정의

`Semaphore`의 동작 원리는 기존의 4가지 규칙 분석 프레임워크에 다음과 같은 변화를 요구한다.

-   **규칙 2 (경합)의 무효화:** `Semaphore(100)`은 100개의 스레드가 임계 구역에 동시 진입하는 것을 '허용'하는 것이 정상 동작이므로, 기존의 '동시 실행 경합'은 오류가 아니다.
-   **규칙 1, 3, 4의 새로운 의미:**
    -   **규칙 3 (정원 초과):** `Semaphore`가 이 오류를 완벽하게 방지하는지 검증하는 것이 핵심 목표가 된다.
    -   **규칙 1 (값 불일치) & 규칙 4 (상태 전이):** `Semaphore`가 임계 구역 내 연산의 원자성까지는 보장하지 못한다는 '기술적 한계'를 증명하는 중요한 분석 포인트가 된다.

## 3. 새로운 성능 측정 전략 및 핵심 지표

`Semaphore`는 스레드를 대기시키지 않는 `tryAcquire()`를 사용하므로, '대기 시간'과 '작업 시간'이라는 기존 지표는 더 이상 유효하지 않다. 따라서 다음과 같은 새로운 측정 전략을 수립한다.

### 3.1. 새로운 핵심 지표

1.  **허가 획득 성공률 (Permit Acquisition Rate):**
    -   **의미:** `tryAcquire()`가 `true`를 반환한 비율. 시스템이 정상적으로 처리한 요청의 비율을 의미한다.
    -   **역할:** 시스템의 안정적인 처리량을 보여준다.

2.  **허가 획득 실패율 (Permit Rejection Rate):**
    -   **의미:** `tryAcquire()`가 `false`를 반환한 비율. 시스템이 과부하를 방지하기 위해 거절한 요청의 비율을 의미한다.
    -   **역할:** `Semaphore`의 부하 제어(Throttling) 능력을 정량적으로 보여준다.

3.  **총 소요 시간 (Total Time):**
    -   **의미:** 요청이 시작된 시점부터, 성공이든 실패든 그 결과를 받기까지 걸린 전체 시간.
    -   **역할:** 모든 동기화 방식(`synchronized`, `ReentrantLock` 포함)을 공정하게 비교하기 위한 **새로운 통합 성능 지표**이다.
        -   **Lock 방식:** `총 소요 시간 = 대기 시간 + 작업 시간`
        -   **Semaphore 방식:** `총 소요 시간 = tryAcquire() 포함 로직의 전체 실행 시간`

4.  **CPU 사용량 (CPU Usage):**
    -   **의미:** 테스트 실행 중 프로세스의 CPU 점유율.
    -   **역할:** `Semaphore`의 기반이 되는 CAS/스핀(Spin) 방식이 시스템에 가하는 부하를 측정하고, 블로킹(Blocking) 방식의 `ReentrantLock`과 비교하는 데 사용된다.

### 3.2. 로깅 전략 재설계

위 지표들을 측정하기 위해, 다음과 같이 로깅 이벤트를 재설계한다.

-   **`JOIN_PERMIT_ATTEMPT`**: `semaphore.tryAcquire()` 호출 직전에 기록. (전체 요청 수 기준)
-   **`JOIN_PERMIT_SUCCESS`**: `tryAcquire()`가 `true`를 반환했을 때 기록.
-   **`JOIN_PERMIT_FAIL`**: `tryAcquire()`가 `false`를 반환했을 때 기록.

## 4. 최종 분석 및 결론 도출 방향

`Semaphore` 테스트를 통해 얻은 데이터를 바탕으로, 다음과 같은 결론을 도출한다.

-   `Semaphore`는 **'정원 초과' 문제는 완벽하게 해결**하지만, 임계 구역 내 연산의 **원자성까지는 보장하지 못하여 '값 불일치' 오류가 발생할 수 있다**는 한계를 증명한다.
-   `synchronized`와 같은 블로킹 락과 비교했을 때, `Semaphore`는 과도한 요청을 **'대기'시키는 대신 '거절'**함으로써 시스템 전체의 안정성과 빠른 응답성을 확보하는 다른 패러다임의 해결책임을 '총 소요 시간'과 '성공/실패율' 데이터로 보여준다.
-   'CPU 사용량' 데이터를 통해, 두 방식 간의 **'컨텍스트 스위칭 비용' vs '스핀 비용'**이라는 더 깊은 수준의 성능 트레이드오프를 분석한다.
# 📘 정석 시나리오 테스트 작성 절차

이 문서는 상태 기반 흐름 제어 시스템에 대한 시나리오 테스트를 설계할 때 따라야 할 **1단계부터 9단계까지의 전체 작성 절차**를 정의한 기준 문서이다.  
각 단계는 단독 항목이 아니라, 설계-구현-관측-복구의 전 주기를 포괄하는 구조적 검증 프레임워크를 형성한다.

---

## ✅ 전체 절차 요약

---

### 1️⃣ 검증 대상 흐름 정의

- 기능 단위가 아니라 “상태 흐름 단위”로 정의되어야 함
- 상태 A → 트리거 → 상태 B로 전이되는 흐름을 기준으로 식별
- 흐름에는 시작 조건, 전이 조건, 종료 조건이 명확히 존재해야 함

---

### 2️⃣ 설계 문서 및 책임 매핑

- 흐름에 참여하는 컴포넌트를 “클래스”가 아니라 “설계 책임 단위” 기준으로 분해
- Triggerer / StateChanger / Finalizer / PostCleaner / StateVerifier 기준으로 분리
- 각 책임은 어떤 문서에, 어떤 메서드로 정의되어 있는지를 명시

---

### 3️⃣ 시나리오 ID 부여 및 흐름 분해

- 모든 흐름에 고유한 ID (예: SCN-ENTRY-001)를 부여
- 흐름은 진입 조건 → 트리거 → 전이 → 실패 분기 → 종료 조건으로 분해
- 각 단위는 Assertion 및 실패 복구 흐름과 연결됨

---

### 4️⃣ 전제 조건 정의

- 테스트 실행 직전 시스템 상태를 정의
- DB 상태, Redis 상태, session 상태, 메모리 객체 등 초기 조건을 명확히 기술
- 테스트 격리성과 재현성을 보장하기 위한 기반

---

### 5️⃣ 트리거 명시

- 어떤 요청 또는 내부 이벤트가 흐름을 시작시키는지 명시
- REST 호출, WebSocket 연결, 스케줄러 기동 등
- 비동기 흐름인 경우 stabilization 조건도 함께 정의

---

### 6️⃣ 기대 상태 전이 정의

- 흐름이 설계대로 작동했을 때 시스템은 어떤 상태로 전이되어야 하는가
- 전이 전후 객체 상태 변화, 로그 출력, DB 반영 여부 등 기술
- 흐름 중 조건 분기 및 예외 흐름 여부도 포함

---

### 7️⃣ Assertion 항목 명시

- 로그, 세션, DB, 메모리 상태, 응답 코드 등으로 검증
- 핵심 상태 객체의 존재 여부 또는 누락 검증
- 부작용 여부 (permit 누수, 중복 세션 등)도 반드시 확인

---

### 8️⃣ 실패 및 복구 흐름 정의

- 설계자가 의도한 흐름 외에 어떤 실패가 발생할 수 있는지
- 실패 시 시스템은 어떻게 감지하고 회복해야 하는지
- 복구가 불가능하다면 어떤 로그 또는 제한 동작이 남아야 하는지

---

### 9️⃣ 테스트 실행 전략

- 단위 테스트, 통합 테스트, 자동화 테스트 중 어떤 방식으로 실행할 것인가
- 사용하는 도구: JUnit, WebSocketClient, Embedded Redis 등
- 테스트마다 mock, spy, fixture가 필요한 컴포넌트를 정의

---

> 이 절차는 단순 기능 실행 확인이 아닌, **설계 보장 흐름에 대한 구조적 검증 체계**를 정립하기 위한 것이다.
> 각 단계는 단절된 절차가 아니라, Assertion이 설계를 기준으로 검증되도록 하는 **계층적 실행 기반**을 제공한다.